# Консольный сетевой чат на RabbitMQ

Проект представляет собой консольный многопользовательский чат, использующий WebSocket для связи между клиентом и сервером, и RabbitMQ на стороне сервера для управления потоками сообщений между чат-комнатами.

## Сборка и запуск

1. **Сервер**

```bash
cd server
./gradlew bootJar
docker compose up --build
```

2. **Клиент**

```bash
cd client
./gradlew bootJar
java -jar ./build/libs/<name>.jar <address> <chat>
```

## Архитектура

Система состоит из трех основных компонентов: Клиент, Сервер и RabbitMQ.

1. **Клиент (`client`):**
   * Консольное Java-приложение, созданное с использованием Spring Boot.
   * Подключается к серверу по протоколу WebSocket (`ws://<server_address>:8080/chat`).
   * Позволяет пользователю вводить имя чата для подключения, отправлять сообщения в текущий чат и получать сообщения от других участников.
   * Поддерживает команду `/connect <имя_чата>` (а также `/switch` в качестве alias) для смены активной чат-комнаты.

2. **Сервер (`server`):**
    * Приложение на Spring Boot, реализующее WebSocket-сервер.
    * Использует RabbitMQ как брокер сообщений для маршрутизации сообщений внутри чат-комнат.
    * **Принцип работы с чатами:**
        * Каждая чат-комната представлена отдельной очередью в RabbitMQ.
        * При подключении клиента к чату (команда `/connect <имя_чата>`), сервер подписывает WebSocket-сессию клиента на соответствующую чат-комнату. Если комната (и очередь RabbitMQ) не существует, она создается динамически.
        * Когда клиент отправляет сообщение, WebSocket-обработчик на сервере публикует это сообщение в очередь RabbitMQ, ассоциированную с текущей чат-комнатой клиента.
        * Специальные слушатели (по одному на каждую активную чат-комнату) получают сообщения из своих очередей RabbitMQ и рассылают их всем клиентам (WebSocket-сессиям), подключенным к данной комнате.
    * Информация о текущих подключениях пользователей к чатам хранится в памяти сервера.
    * Настроен для работы с Docker и Docker Compose, что упрощает развертывание вместе с RabbitMQ.

3. **RabbitMQ:**
    * Внешний брокер сообщений, используемый сервером.
    * Обеспечивает асинхронную доставку сообщений и разделение логики чат-комнат.

## Возможности

* **Консольный интерфейс:** Взаимодействие с чатом осуществляется через командную строку.
* **Многопользовательский чат:** Поддержка одновременного общения нескольких пользователей.
* **Чат-комнаты:**
  * Пользователи могут подключаться к различным именованным чат-комнатам.
  * Чат-комнаты (и соответствующие очереди в RabbitMQ) создаются динамически при первом подключении к ним.
* **Обмен сообщениями:** Отправка и получение текстовых сообщений в реальном времени в рамках выбранной чат-комнаты.
* **Переключение чатов:** Клиентская команда `/switch <новое_имя_чата>` позволяет пользователю сменить текущую чат-комнату.
* **Запуск клиента:**
  * Из командной строки после сборки `client.jar`:
  * `java -jar client.jar <имя_чата>` (подключение к серверу на `127.0.0.1:8080`)
  * `java -jar client.jar <адрес_сервера> <имя_чата>` (подключение к указанному серверу)
* **Развертывание сервера:**
  * Серверная часть может быть легко развернута с использованием Docker Compose, который также запускает контейнер с RabbitMQ (`server/docker-compose.yaml`).
* **CI:** Проект включает базовый CI-пайплайн на GitHub Actions для сборки и простого интеграционного теста.
